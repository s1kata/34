<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Вход | Travel Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&family=Open+Sans:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-body: #f4f9ff;
      --accent-primary: #3ba3ff;
      --accent-secondary: #7bc4ff;
      --text-primary: #1f2a44;
      --text-secondary: #4f5f78;
      --border-soft: rgba(59, 163, 255, 0.18);
      --shadow-soft: 0 20px 48px rgba(59, 163, 255, 0.18);
    }
    body {
      font-family: 'Open Sans', sans-serif;
      background: linear-gradient(180deg, #f8fbff 0%, #eff5ff 45%, #fdfdff 100%);
      color: var(--text-primary);
    }
    .heading-font { font-family: 'Montserrat', sans-serif; }
    .floating-glow {
      position: absolute;
      border-radius: 999px;
      filter: blur(160px);
      opacity: 0.5;
    }
    .error-message { color: #f87171; font-size: 0.85rem; margin-top: 4px; text-align: left; }
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(239, 68, 68, 0.95);
      color: #fff;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 20px 40px rgba(239, 68, 68, 0.25);
      z-index: 1000;
      opacity: 0;
      transition: opacity .3s ease;
      font-size: 0.9rem;
      text-align: center;
    }
    .toast.show { opacity: 1; }
  </style>
</head>
<body class="min-h-screen text-slate-900 relative overflow-hidden">
  <div class="floating-glow bg-sky-200 w-[480px] h-[480px] -top-24 -left-24"></div>
  <div class="floating-glow bg-sky-300 w-[520px] h-[520px] bottom-0 right-0"></div>

  <div id="toast" class="toast"></div>

  <!-- Header -->
  <header class="bg-white/95 backdrop-blur-lg border-b border-sky-100 sticky top-0 z-50 shadow-sm">
    <div class="mx-auto w-full max-w-[95vw] px-4 md:px-8 lg:px-16 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <a href="/index.php" class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-gradient-to-r from-sky-300 via-sky-400 to-sky-500 flex items-center justify-center shadow-lg shadow-sky-200/60">
            <i class="fas fa-plane text-white text-base"></i>
          </div>
          <span class="heading-font text-2xl font-bold text-sky-600 tracking-wide">Travel Hub</span>
        </a>
      </div>

      <nav class="hidden md:flex items-center space-x-8">
        <a href="/index.php" class="text-slate-700 font-medium hover:text-sky-500 transition">Главная</a>
        <a href="/frontend/window/tours.php" class="text-slate-700 font-medium hover:text-sky-500 transition">Туры</a>
        <a href="/frontend/window/services.php" class="text-slate-700 font-medium hover:text-sky-500 transition">Услуги</a>
        <a href="/frontend/window/about.php" class="text-slate-700 font-medium hover:text-sky-500 transition">О нас</a>
        <a href="/frontend/window/contacts.php" class="text-slate-700 font-medium hover:text-sky-500 transition">Контакты</a>
      </nav>

      <div class="flex items-center space-x-4">
        <a href="/index.php" class="hidden md:block text-slate-600 hover:text-sky-500 transition text-sm">На главную</a>
        <button id="mobile-menu-button" class="md:hidden text-slate-500">
          <i class="fas fa-bars text-2xl"></i>
        </button>
      </div>
    </div>
    
    <div id="mobile-menu" class="hidden md:hidden bg-white/95 border-t border-sky-100 py-4 px-4">
      <div class="flex flex-col space-y-3">
        <a href="/index.php" class="text-slate-700 font-medium hover:text-sky-500 transition">Главная</a>
        <a href="/frontend/window/tours.php" class="text-slate-700 font-medium hover:text-sky-500 transition">Туры</a>
        <a href="/frontend/window/services.php" class="text-slate-700 font-medium hover:text-sky-500 transition">Услуги</a>
        <a href="/frontend/window/about.php" class="text-slate-700 font-medium hover:text-sky-500 transition">О нас</a>
        <a href="/frontend/window/contacts.php" class="text-slate-700 font-medium hover:text-sky-500 transition">Контакты</a>
      </div>
    </div>
  </header>

  <main class="relative z-10 flex items-center justify-center min-h-screen px-4 py-16">
    <div class="max-w-5xl w-full grid lg:grid-cols-2 gap-10">
      <div class="hidden lg:flex flex-col justify-center space-y-6 pr-6">
        <span class="inline-flex items-center gap-3 text-xs uppercase tracking-[0.32em] text-sky-500">
          <i class="fas fa-gem"></i> Travel Hub
        </span>
        <h1 class="heading-font text-4xl font-bold text-slate-900 leading-tight">Персональный кабинет Travel Hub</h1>
        <p class="text-slate-600">Доступ к заявкам, бронированиям и эксклюзивным предложениям. Войдите, чтобы продолжить планирование путешествия мечты.</p>
      </div>

      <div class="backdrop-blur-lg bg-white/90 border border-sky-100 rounded-2xl p-8 shadow-xl shadow-sky-200/60">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="heading-font text-2xl font-semibold text-slate-900" id="loginTitle">Login</h2>
            <p class="text-sm text-slate-500">Введите данные учетной записи Travel Hub.</p>
          </div>
          <a href="/index.php" class="text-xs uppercase tracking-[0.3em] text-sky-500 hover:text-sky-600 transition">На главную</a>
        </div>

        <form id="loginForm" method="POST" action="/backend/scripts/process_login.php" class="space-y-5">
          <div>
            <label for="email" class="block text-sm text-slate-600 mb-2">Email</label>
            <input type="email" id="email" name="email" placeholder="Email" required class="w-full rounded-xl border border-sky-100 bg-white px-4 py-3 text-slate-800 focus:outline-none focus:ring-2 focus:ring-sky-300 focus:border-sky-300 transition" />
            <div id="emailError" class="error-message"></div>
          </div>

          <div>
            <label for="password" class="block text-sm text-slate-600 mb-2">Пароль</label>
            <input type="password" id="password" name="password" placeholder="Password" required class="w-full rounded-xl border border-sky-100 bg-white px-4 py-3 text-slate-800 focus:outline-none focus:ring-2 focus:ring-sky-300 focus:border-sky-300 transition" />
            <div id="passwordError" class="error-message"></div>
          </div>

          <div class="flex items-center justify-between text-sm text-slate-500">
            <label class="flex items-center gap-2">
              <input type="checkbox" id="remember" name="remember" class="w-4 h-4 rounded border-sky-300 text-sky-500 focus:ring-sky-400" />
              <span id="rememberLabel">Запомнить меня</span>
            </label>
            <a href="mailto:concierge@travelhub.ru" class="text-sky-500 hover:text-sky-600 transition">Забыли пароль?</a>
          </div>

          <div id="loginError" class="error-message text-center"></div>

          <button type="submit" name="login" id="loginButton" class="w-full heading-font uppercase tracking-[0.3em] text-xs bg-gradient-to-r from-sky-300 via-sky-400 to-sky-500 text-white py-3 rounded-xl shadow-lg shadow-sky-200/60 hover:shadow-sky-300/70 transition">
            Login
          </button>

          <p class="text-center text-sm text-slate-500">
            <a id="registerLink" href="registration.html" class="text-sky-500 hover:text-sky-600 transition">Don't have an account? Register!</a>
          </p>
        </form>
      </div>
    </div>
  </main>

  <script src="https://kit.fontawesome.com/6dc53f782f.js" crossorigin="anonymous"></script>
  <script>
    const loginTranslations = {
      ru: {
        title: "Вход",
        emailPlaceholder: "Email",
        passwordPlaceholder: "Пароль",
        loginButton: "Вход",
        registerLink: "Нет аккаунта? Зарегистрируйтесь!",
        emailRequired: "Пожалуйста, введите email.",
        emailInvalid: "Пожалуйста, введите корректный email.",
        passwordRequired: "Пожалуйста, введите пароль.",
        passwordLength: "Пароль должен содержать не менее 12 символов.",
        accountNotFound: "Аккаунта с таким email не существует. <a href='/frontend/window/registration.html'>Зарегистрируйтесь</a>.",
        rememberMe: "Запомнить меня"
      },
      en: {
        title: "Login",
        emailPlaceholder: "Email",
        passwordPlaceholder: "Password",
        loginButton: "Login",
        registerLink: "Don't have an account? Register!",
        emailRequired: "Please enter your email.",
        emailInvalid: "Please enter a valid email.",
        passwordRequired: "Please enter your password.",
        passwordLength: "Password must be at least 12 characters long.",
        accountNotFound: "Account with this email does not exist. <a href='/frontend/window/registration.html'>Register</a>.",
        rememberMe: "Remember me"
      }
    };

    function toggleLanguage() {
      const currentLang = localStorage.getItem('language') || 'en';
      const newLang = currentLang === 'en' ? 'ru' : 'en';
      localStorage.setItem('language', newLang);
      applyLoginLanguage(newLang);
      updateLangButton(newLang);
    }

    function applyLoginLanguage(lang) {
      const trans = loginTranslations[lang];
      document.getElementById('loginTitle').textContent = trans.title;
      document.getElementById('email').placeholder = trans.emailPlaceholder;
      document.getElementById('password').placeholder = trans.passwordPlaceholder;
      document.getElementById('loginButton').textContent = trans.loginButton;
      document.getElementById('registerLink').textContent = trans.registerLink;
      document.getElementById('rememberLabel').textContent = trans.rememberMe;
      window.currentValidationMessages = trans;
    }

    function updateLangButton(lang) {
      const button = document.getElementById('lang-toggle');
      if (button) button.textContent = lang.toUpperCase();
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.innerHTML = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 5000);
    }

    async function checkUserAuth() {
      try {
        const response = await fetch('/backend/scripts/check_auth.php', { credentials: 'same-origin' });
        const data = await response.json();
        return data.authenticated;
      } catch (error) {
        console.error('Ошибка проверки авторизации:', error);
        return false;
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const form = document.getElementById('loginForm');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      const emailError = document.getElementById('emailError');
      const passwordError = document.getElementById('passwordError');
      const loginError = document.getElementById('loginError');

      const savedLang = localStorage.getItem('language') || 'en';
      applyLoginLanguage(savedLang);
      updateLangButton(savedLang);

      const isAuthenticated = await checkUserAuth();
      if (isAuthenticated) {
        window.location.href = '/frontend/window/dashboard.php';
        return;
      }

      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has('errors')) {
        try {
          const errors = JSON.parse(decodeURIComponent(urlParams.get('errors')));
          if (errors.email) emailError.textContent = errors.email;
          if (errors.password) passwordError.textContent = errors.password;
          if (errors.login) loginError.textContent = errors.login;
          if (errors.database) loginError.textContent = errors.database;
          if (errors.account_not_found) showToast(window.currentValidationMessages.accountNotFound);
        } catch (e) {
          console.error('Ошибка разбора ошибок авторизации', e);
        }
      }

      // Mobile menu toggle
      document.getElementById('mobile-menu-button').addEventListener('click', function() {
        const menu = document.getElementById('mobile-menu');
        menu.classList.toggle('hidden');
      });

      form.addEventListener('submit', (event) => {
        emailError.textContent = '';
        passwordError.textContent = '';
        loginError.textContent = '';

        let isValid = true;
        const emailValue = emailInput.value.trim();
        if (emailValue === '') {
          emailError.textContent = window.currentValidationMessages.emailRequired;
          isValid = false;
        } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailValue)) {
          emailError.textContent = window.currentValidationMessages.emailInvalid;
          isValid = false;
        }

        const passwordValue = passwordInput.value.trim();
        if (passwordValue === '') {
          passwordError.textContent = window.currentValidationMessages.passwordRequired;
          isValid = false;
        } else if (passwordValue.length < 12) {
          passwordError.textContent = window.currentValidationMessages.passwordLength;
          isValid = false;
        }

        if (!isValid) {
          event.preventDefault();
        }
      });
    });
  </script>

  <!-- Footer -->
  <footer class="bg-white border-t border-sky-100 py-10 mt-20">
    <div class="container mx-auto px-6">
      <div class="flex flex-col md:flex-row justify-between gap-8">
        <div class="space-y-3 max-w-sm">
          <span class="heading-font text-2xl font-bold text-sky-600">Travel Hub</span>
          <p class="text-slate-600">Мы создаём путешествия класса люкс и обеспечиваем сервис, который остаётся в памяти надолго.</p>
          <div class="flex gap-3">
            <a href="https://t.me/TravelHub" class="w-9 h-9 rounded-full border border-sky-200 flex items-center justify-center text-slate-500 hover:bg-sky-100 hover:text-sky-500 transition"><i class="fab fa-telegram"></i></a>
            <a href="#" class="w-9 h-9 rounded-full border border-sky-200 flex items-center justify-center text-slate-500 hover:bg-sky-100 hover:text-sky-500 transition"><i class="fab fa-instagram"></i></a>
            <a href="#" class="w-9 h-9 rounded-full border border-sky-200 flex items-center justify-center text-slate-500 hover:bg-sky-100 hover:text-sky-500 transition"><i class="fab fa-whatsapp"></i></a>
          </div>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 text-sm text-slate-600">
          <div>
            <h3 class="font-semibold text-slate-800 mb-3">Компания</h3>
            <ul class="space-y-2">
              <li><a href="#" class="hover:text-sky-500">О нас</a></li>
              <li><a href="#" class="hover:text-sky-500">Команда</a></li>
              <li><a href="#" class="hover:text-sky-500">Партнёры</a></li>
            </ul>
          </div>
          <div>
            <h3 class="font-semibold text-slate-800 mb-3">Туры</h3>
            <ul class="space-y-2">
              <li><a href="#" class="hover:text-sky-500">Премиум</a></li>
              <li><a href="#" class="hover:text-sky-500">Семейные</a></li>
              <li><a href="#" class="hover:text-sky-500">Медовый месяц</a></li>
            </ul>
          </div>
          <div>
            <h3 class="font-semibold text-slate-800 mb-3">Консьерж</h3>
            <ul class="space-y-2">
              <li><a href="#" class="hover:text-sky-500">Привилегии</a></li>
              <li><a href="#" class="hover:text-sky-500">Кейсы</a></li>
              <li><a href="#" class="hover:text-sky-500">FAQ</a></li>
            </ul>
          </div>
          <div>
            <h3 class="font-semibold text-slate-800 mb-3">Контакты</h3>
            <ul class="space-y-2">
              <li><a href="#" class="hover:text-sky-500">Заявка</a></li>
              <li><a href="#" class="hover:text-sky-500">Telegram</a></li>
              <li><a href="#" class="hover:text-sky-500">WhatsApp</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="mt-10 flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-slate-500">
        <p>© 2024 Travel Hub. Все права защищены.</p>
        <div class="flex gap-4">
          <a href="#" class="hover:text-sky-500">Политика конфиденциальности</a>
          <a href="#" class="hover:text-sky-500">Условия использования</a>
        </div>
      </div>
    </div>
  </footer>
</body>
</html>
